"""
æµ‹è¯•ç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent çš„é›†æˆ

éªŒè¯ç»¼åˆå†³ç­– Agent æ˜¯å¦èƒ½å¤Ÿï¼š
1. æ¥æ”¶æˆæœ¬åˆ†æ Agent çš„è¾“å‡º
2. æ¥æ”¶é£é™©è¯„ä¼° Agent çš„è¾“å‡º
3. æ¥æ”¶ç”¨æˆ·ä»·å€¼ Agent çš„è¾“å‡º
4. æ­£ç¡®å¤„ç†è¿™äº›è¾“å…¥
5. è¾“å‡ºç¬¦åˆè¦æ±‚çš„æœ€ç»ˆå†³ç­–
"""

import asyncio
import sys
import os

# æ·»åŠ é¡¹ç›®è·¯å¾„
project_root = os.path.join(os.path.dirname(__file__), '..')
sys.path.insert(0, project_root)
src_path = os.path.join(project_root, 'src')
if src_path not in sys.path:
    sys.path.insert(0, src_path)


async def test_supervisor_with_real_agent_outputs():
    """æµ‹è¯•ç»¼åˆå†³ç­– Agent å¤„ç†çœŸå® Agent è¾“å‡ºçš„èƒ½åŠ›"""

    print("\n" + "="*80)
    print("ğŸ§ª æµ‹è¯•ï¼šç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent çš„é›†æˆ")
    print("="*80)

    from src.agents.supervisor_agent import SupervisorAgent

    # åˆ›å»ºç»¼åˆå†³ç­– Agent
    supervisor = SupervisorAgent()

    # æ¨¡æ‹Ÿå‰ä¸‰ä¸ª Agent çš„çœŸå®è¾“å‡ºï¼ˆæ ¹æ®å®é™…çš„ Agent è¾“å‡ºæ ¼å¼ï¼‰
    print("\nğŸ“¥ æ­¥éª¤ 1/4: æ¥æ”¶æˆæœ¬åˆ†æ Agent çš„è¾“å‡º")
    print("-" * 80)

    cost_analysis = """
## ğŸ’° æˆæœ¬åˆ†æ

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- æ—¶é—´æˆæœ¬ï¼šéœ€è¦é€‚åº”æœŸ 1-3 ä¸ªæœˆ
- é‡‘é’±æˆæœ¬ï¼šåˆæœŸå¯èƒ½è–ªèµ„ç•¥ä½ï¼Œä½†æœ‰å¢é•¿ç©ºé—´
- èµ„æºæˆæœ¬ï¼šéœ€è¦é‡æ–°å»ºç«‹äººé™…å…³ç³»å’Œå·¥ä½œæµç¨‹
- æœºä¼šæˆæœ¬ï¼šå¤±å»å½“å‰å…¬å¸çš„ç¨³å®šæ€§å’Œç†Ÿæ‚‰çš„å·¥ä½œç¯å¢ƒ
- **ç»¼åˆæˆæœ¬è¯„åˆ†**ï¼š6/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- æ—¶é—´æˆæœ¬ï¼šæ— éœ€é€‚åº”æœŸï¼Œå¯ç«‹å³æŠ•å…¥å·¥ä½œ
- é‡‘é’±æˆæœ¬ï¼šå½“å‰è–ªèµ„ç¨³å®šï¼Œä½†å¢é•¿æœ‰é™
- èµ„æºæˆæœ¬ï¼šå·²æœ‰å®Œå–„çš„äººé™…å…³ç³»å’Œå·¥ä½œæµç¨‹
- æœºä¼šæˆæœ¬ï¼šå¤±å»æ–°æœºä¼šå’Œå‘å±•ç©ºé—´
- **ç»¼åˆæˆæœ¬è¯„åˆ†**ï¼š4/10

### é€‰é¡¹3ï¼šç»§ç»­è§‚æœ›
- æ—¶é—´æˆæœ¬ï¼šè§‚æœ›æœŸé—´æ— å®è´¨è¿›å±•
- é‡‘é’±æˆæœ¬ï¼šæ— é¢å¤–æˆæœ¬
- èµ„æºæˆæœ¬ï¼šå ç”¨å†³ç­–ç²¾åŠ›
- æœºä¼šæˆæœ¬ï¼šé”™è¿‡å½“å‰è·³æ§½çš„æœ€ä½³æ—¶æœº
- **ç»¼åˆæˆæœ¬è¯„åˆ†**ï¼š3/10

### ğŸ’¡ æˆæœ¬ç»´åº¦æ¨è
ä»æˆæœ¬è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šæ—¶é—´æˆæœ¬å’Œèµ„æºæˆæœ¬æ›´ä½ï¼Œé€‚åº”å‹åŠ›å°ï¼Œç¡®å®šæ€§æ›´å¼º

---

**æˆæœ¬åˆ†ææ€»ç»“**ï¼š
- ç•™åœ¨åŸå…¬å¸æˆæœ¬æœ€ä½ï¼ˆ4/10ï¼‰
- è·³æ§½æˆæœ¬ä¸­ç­‰ï¼ˆ6/10ï¼‰
- ç»§ç»­è§‚æœ›æˆæœ¬æ¬¡ä½ï¼ˆ3/10ï¼‰ï¼Œä½†é•¿æœŸæœºä¼šæˆæœ¬é«˜
"""

    print(f"âœ… å·²æ¥æ”¶æˆæœ¬åˆ†æ Agent çš„è¾“å‡º")
    print(f"   - åˆ†æäº† 3 ä¸ªé€‰é¡¹")
    print(f"   - æˆæœ¬ç»´åº¦æ¨èï¼šç•™åœ¨åŸå…¬å¸")
    print(f"   - è¾“å‡ºé•¿åº¦ï¼š{len(cost_analysis)} å­—ç¬¦")

    print("\nğŸ“¥ æ­¥éª¤ 2/4: æ¥æ”¶é£é™©è¯„ä¼° Agent çš„è¾“å‡º")
    print("-" * 80)

    risk_analysis = """
## âš ï¸ é£é™©è¯„ä¼°

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- ä¸ç¡®å®šæ€§å› ç´ ï¼šæ–°å…¬å¸æ–‡åŒ–ã€å›¢é˜Ÿæ°›å›´ã€å·¥ä½œå†…å®¹ã€ä¸šåŠ¡ç¨³å®šæ€§
- æœ€åæƒ…å†µï¼šä¸é€‚åº”æ–°ç¯å¢ƒï¼Œ3ä¸ªæœˆå†…ç¦»èŒï¼Œå½±å“èŒä¸šå‘å±•
- å¤±è´¥æ¦‚ç‡ï¼šä¸­ç­‰ï¼ˆ40%ï¼‰
- å¯é€†æ€§ï¼šéƒ¨åˆ†å¯é€†ï¼Œä½†ä¼šå½±å“ç®€å†å’ŒèŒä¸šå‘å±•
- **ç»¼åˆé£é™©è¯„åˆ†**ï¼š7/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- ä¸ç¡®å®šæ€§å› ç´ ï¼šå…¬å¸å‘å±•å‰æ™¯ã€ä¸ªäººæ™‹å‡ç©ºé—´ã€è–ªèµ„è°ƒæ•´æœºåˆ¶
- æœ€åæƒ…å†µï¼šå…¬å¸ä¸šåŠ¡èç¼©ï¼Œè¢«è¿«ç¦»èŒ
- å¤±è´¥æ¦‚ç‡ï¼šä½ï¼ˆ20%ï¼‰
- å¯é€†æ€§ï¼šä¸å¯é€†ï¼Œé”™è¿‡äº†å½“å‰è·³æ§½çš„æœ€ä½³æ—¶æœº
- **ç»¼åˆé£é™©è¯„åˆ†**ï¼š5/10

### é€‰é¡¹3ï¼šç»§ç»­è§‚æœ›
- ä¸ç¡®å®šæ€§å› ç´ ï¼šæœªæ¥æœºä¼šå˜åŒ–ã€å¸‚åœºè¡Œæƒ…æ³¢åŠ¨
- æœ€åæƒ…å†µï¼šè§‚æœ›æœŸé—´å…¬å¸è£å‘˜ï¼Œå¤±å»å½“å‰ç¨³å®šå·¥ä½œ
- å¤±è´¥æ¦‚ç‡ï¼šä¸­ç­‰ï¼ˆ35%ï¼‰
- å¯é€†æ€§ï¼šå¯é€†
- **ç»¼åˆé£é™©è¯„åˆ†**ï¼š6/10

### ğŸ’¡ é£é™©ç»´åº¦æ¨è
ä»é£é™©è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šé£é™©æœ€ä½ï¼ˆ5/10ï¼‰ï¼Œç¡®å®šæ€§æœ€å¼ºï¼Œå¤±è´¥æ¦‚ç‡æœ€å°

---

**é£é™©è¯„ä¼°æ€»ç»“**ï¼š
- ç•™åœ¨åŸå…¬å¸é£é™©æœ€ä½ï¼ˆ5/10ï¼‰
- ç»§ç»­è§‚æœ›é£é™©ä¸­ç­‰ï¼ˆ6/10ï¼‰
- è·³æ§½é£é™©æœ€é«˜ï¼ˆ7/10ï¼‰
"""

    print(f"âœ… å·²æ¥æ”¶é£é™©è¯„ä¼° Agent çš„è¾“å‡º")
    print(f"   - è¯„ä¼°äº† 3 ä¸ªé€‰é¡¹çš„é£é™©")
    print(f"   - é£é™©ç»´åº¦æ¨èï¼šç•™åœ¨åŸå…¬å¸")
    print(f"   - è¾“å‡ºé•¿åº¦ï¼š{len(risk_analysis)} å­—ç¬¦")

    print("\nğŸ“¥ æ­¥éª¤ 3/4: æ¥æ”¶ç”¨æˆ·ä»·å€¼ Agent çš„è¾“å‡º")
    print("-" * 80)

    value_analysis = """
## ğŸ’ ä»·å€¼åŒ¹é…åˆ†æ

åŸºäºç”¨æˆ·çš„å†å²å¯¹è¯å’Œå½“å‰è¡¨è¿°ï¼Œç”¨æˆ·é‡è§†ç¨³å®šæ€§å’Œå®‰å…¨æ„Ÿï¼ŒåŒæ—¶å…³æ³¨é•¿æœŸå‘å±•ã€‚

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- æˆå°±å¯¼å‘ï¼š9/10ï¼Œæœ‰æ›´å¤šæˆé•¿å’ŒæŒ‘æˆ˜æœºä¼šï¼Œç¬¦åˆèŒä¸šå‘å±•ç›®æ ‡
- å®‰å…¨æ„Ÿï¼š4/10ï¼Œä¸ç¡®å®šæ€§è¾ƒé«˜ï¼Œç¨³å®šæ€§ä¸è¶³
- è‡ªä¸»æ€§ï¼š7/10ï¼Œå¯èƒ½è·å¾—æ›´å¤šè‡ªä¸»æƒå’Œå†³ç­–ç©ºé—´
- å…³ç³»å¯¼å‘ï¼š5/10ï¼Œéœ€è¦é‡æ–°å»ºç«‹äººé™…å…³ç³»
- é•¿æœŸå‘å±•ï¼š8/10ï¼Œæœ‰æ›´å¤§çš„æˆé•¿ç©ºé—´
- **ç»¼åˆä»·å€¼è¯„åˆ†**ï¼š6/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- æˆå°±å¯¼å‘ï¼š5/10ï¼Œå‘å±•ç©ºé—´æœ‰é™ï¼Œå¯èƒ½é‡åˆ°èŒä¸šç“¶é¢ˆ
- å®‰å…¨æ„Ÿï¼š9/10ï¼Œå·¥ä½œç¨³å®šï¼Œç¯å¢ƒç†Ÿæ‚‰
- è‡ªä¸»æ€§ï¼š6/10ï¼Œæœ‰ä¸€å®šè‡ªä¸»æƒä½†ç©ºé—´æœ‰é™
- å…³ç³»å¯¼å‘ï¼š8/10ï¼Œå·²æœ‰ç¨³å®šçš„äººé™…å…³ç³»
- é•¿æœŸå‘å±•ï¼š4/10ï¼Œå‘å±•æœºä¼šæœ‰é™
- **ç»¼åˆä»·å€¼è¯„åˆ†**ï¼š7/10

### é€‰é¡¹3ï¼šç»§ç»­è§‚æœ›
- æˆå°±å¯¼å‘ï¼š3/10ï¼Œæ— å®è´¨è¿›å±•
- å®‰å…¨æ„Ÿï¼š7/10ï¼Œç»´æŒç°çŠ¶
- è‡ªä¸»æ€§ï¼š8/10ï¼Œå¯ä»¥è‡ªç”±æ¢ç´¢å…¶ä»–æœºä¼š
- å…³ç³»å¯¼å‘ï¼š7/10ï¼Œä¿æŒç°æœ‰å…³ç³»
- é•¿æœŸå‘å±•ï¼š5/10ï¼Œè§‚æœ›æœŸé—´æ— æˆé•¿
- **ç»¼åˆä»·å€¼è¯„åˆ†**ï¼š5/10

### ğŸ’¡ ä»·å€¼ç»´åº¦æ¨è
ä»ç”¨æˆ·ä»·å€¼è§‚è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šæ›´ç¬¦åˆç”¨æˆ·é‡è§†çš„å®‰å…¨æ„Ÿå’Œç¨³å®šæ€§ä»·å€¼è§‚ï¼ˆ9/10ï¼‰ï¼Œè™½ç„¶æœ‰å‘å±•ç“¶é¢ˆï¼Œä½†é£é™©å¯æ§

---

**ç”¨æˆ·ä»·å€¼åˆ†ææ€»ç»“**ï¼š
- ç”¨æˆ·æ ¸å¿ƒä»·å€¼è§‚ï¼šå®‰å…¨æ„Ÿ > å…³ç³»å¯¼å‘ > è‡ªä¸»æ€§ > æˆå°±å¯¼å‘
- ç•™åœ¨åŸå…¬å¸ä»·å€¼è¯„åˆ†æœ€é«˜ï¼ˆ7/10ï¼‰ï¼Œæœ€ç¬¦åˆç”¨æˆ·ä»·å€¼è§‚
- è·³æ§½ä»·å€¼è¯„åˆ†ä¸­ç­‰ï¼ˆ6/10ï¼‰ï¼Œç¬¦åˆæˆå°±å¯¼å‘ä½†ä¸ç¬¦åˆå®‰å…¨æ„Ÿ
- ç»§ç»­è§‚æœ›ä»·å€¼è¯„åˆ†æœ€ä½ï¼ˆ5/10ï¼‰ï¼Œæ— å®è´¨è¿›å±•
"""

    print(f"âœ… å·²æ¥æ”¶ç”¨æˆ·ä»·å€¼ Agent çš„è¾“å‡º")
    print(f"   - åˆ†æäº† 6 ä¸ªä»·å€¼ç»´åº¦")
    print(f"   - ä»·å€¼ç»´åº¦æ¨èï¼šç•™åœ¨åŸå…¬å¸")
    print(f"   - è¾“å‡ºé•¿åº¦ï¼š{len(value_analysis)} å­—ç¬¦")

    print("\nğŸ¤” æ­¥éª¤ 4/4: ç»¼åˆå†³ç­– Agent å¤„ç†å¹¶ç”Ÿæˆæœ€ç»ˆå†³ç­–")
    print("-" * 80)

    # éªŒè¯è¾“å…¥æ•°æ®
    print(f"\nğŸ“Š è¾“å…¥æ•°æ®éªŒè¯ï¼š")
    print(f"  âœ“ æˆæœ¬åˆ†æï¼š{len(cost_analysis)} å­—ç¬¦")
    print(f"  âœ“ é£é™©è¯„ä¼°ï¼š{len(risk_analysis)} å­—ç¬¦")
    print(f"  âœ“ ç”¨æˆ·ä»·å€¼ï¼š{len(value_analysis)} å­—ç¬¦")

    # è°ƒç”¨ç»¼åˆå†³ç­– Agent
    print(f"\nâ³ æ­£åœ¨è°ƒç”¨ç»¼åˆå†³ç­– Agent...")
    print(f"  - å½“å‰è½®æ¬¡ï¼š1")
    print(f"  - ä¸Šä¸€è½®ç»“æœï¼šæ— ï¼ˆç¬¬ä¸€è½®ï¼‰")

    try:
        decision_result = await supervisor.make_decision(
            cost_analysis=cost_analysis,
            risk_analysis=risk_analysis,
            value_analysis=value_analysis,
            current_round=1,
            previous_results=None
        )

        # éªŒè¯è¾“å‡º
        print(f"\nâœ… ç»¼åˆå†³ç­– Agent è°ƒç”¨æˆåŠŸï¼")

        print(f"\nğŸ“‹ å†³ç­–ç»“æœéªŒè¯ï¼š")

        # éªŒè¯ 1: æ˜¯å¦æœ‰æœ€ç»ˆå†³ç­–
        assert 'final_decision' in decision_result, "ç¼ºå°‘ final_decision å­—æ®µ"
        assert decision_result['final_decision'], "final_decision ä¸ºç©º"
        print(f"  âœ“ æœ€ç»ˆå†³ç­–ï¼šå·²ç”Ÿæˆï¼ˆ{len(decision_result['final_decision'])} å­—ç¬¦ï¼‰")

        # éªŒè¯ 2: æ˜¯å¦æœ‰ç»ˆæ­¢åˆ¤æ–­
        assert 'should_stop' in decision_result, "ç¼ºå°‘ should_stop å­—æ®µ"
        print(f"  âœ“ æ˜¯å¦åº”è¯¥åœæ­¢ï¼š{decision_result['should_stop']}")

        # éªŒè¯ 3: æ˜¯å¦æœ‰åœæ­¢åŸå› 
        assert 'stop_reason' in decision_result, "ç¼ºå°‘ stop_reason å­—æ®µ"
        assert decision_result['stop_reason'], "stop_reason ä¸ºç©º"
        print(f"  âœ“ åœæ­¢åŸå› ï¼š{decision_result['stop_reason']}")

        # éªŒè¯ 4: æ˜¯å¦æœ‰å½“å‰è½®æ¬¡
        assert 'current_round' in decision_result, "ç¼ºå°‘ current_round å­—æ®µ"
        print(f"  âœ“ å½“å‰è½®æ¬¡ï¼š{decision_result['current_round']}")

        # éªŒè¯ 5: å†³ç­–å†…å®¹æ˜¯å¦åŒ…å«æ¨èé€‰é¡¹
        final_decision = decision_result['final_decision']
        assert 'ç•™åœ¨åŸå…¬å¸' in final_decision or 'è·³æ§½' in final_decision or 'ç»§ç»­è§‚æœ›' in final_decision, \
            "å†³ç­–å†…å®¹ä¸­æ²¡æœ‰æ˜ç¡®çš„é€‰é¡¹æ¨è"
        print(f"  âœ“ å†³ç­–å†…å®¹åŒ…å«é€‰é¡¹æ¨è")

        # æ˜¾ç¤ºå†³ç­–å†…å®¹
        print(f"\n" + "="*80)
        print("ğŸ¯ æœ€ç»ˆå†³ç­–å†…å®¹")
        print("="*80)
        print(decision_result['final_decision'])

        # æ˜¾ç¤ºå†³ç­–æ‘˜è¦
        print(f"\n" + "="*80)
        print("ğŸ“Š å†³ç­–æ‘˜è¦")
        print("="*80)
        print(f"  æˆæœ¬åˆ†ææ¨èï¼šç•™åœ¨åŸå…¬å¸ï¼ˆæˆæœ¬æœ€ä½ï¼‰")
        print(f"  é£é™©è¯„ä¼°æ¨èï¼šç•™åœ¨åŸå…¬å¸ï¼ˆé£é™©æœ€ä½ï¼‰")
        print(f"  ç”¨æˆ·ä»·å€¼æ¨èï¼šç•™åœ¨åŸå…¬å¸ï¼ˆæœ€ç¬¦åˆä»·å€¼è§‚ï¼‰")
        print(f"  ç»¼åˆå†³ç­–æ¨èï¼šå·²åœ¨æœ€ç»ˆå†³ç­–ä¸­è¯´æ˜")
        print(f"  åº”è¯¥åœæ­¢åˆ†æï¼š{'æ˜¯' if decision_result['should_stop'] else 'å¦'}")
        print(f"  åœæ­¢åŸå› ï¼š{decision_result['stop_reason']}")

        # æµ‹è¯•æ€»ç»“
        print(f"\n" + "="*80)
        print("âœ… æµ‹è¯•ç»“æœï¼šç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent é›†æˆæˆåŠŸï¼")
        print("="*80)

        print(f"\nğŸ“ æµ‹è¯•æ€»ç»“ï¼š")
        print(f"  âœ“ æˆåŠŸæ¥æ”¶æˆæœ¬åˆ†æ Agent çš„è¾“å‡º")
        print(f"  âœ“ æˆåŠŸæ¥æ”¶é£é™©è¯„ä¼° Agent çš„è¾“å‡º")
        print(f"  âœ“ æˆåŠŸæ¥æ”¶ç”¨æˆ·ä»·å€¼ Agent çš„è¾“å‡º")
        print(f"  âœ“ æˆåŠŸå¤„ç†ä¸‰ä¸ªç»´åº¦çš„åˆ†æç»“æœ")
        print(f"  âœ“ æˆåŠŸç”Ÿæˆæœ€ç»ˆå†³ç­–å»ºè®®")
        print(f"  âœ“ æˆåŠŸåšå‡ºç»ˆæ­¢åˆ¤æ–­")
        print(f"  âœ“ å†³ç­–å†…å®¹ç¬¦åˆè¦æ±‚ï¼ˆåŒ…å«æ¨èé€‰é¡¹å’Œç†ç”±ï¼‰")

        return True

    except Exception as e:
        print(f"\nâŒ ç»¼åˆå†³ç­– Agent è°ƒç”¨å¤±è´¥ï¼š{str(e)}")
        import traceback
        traceback.print_exc()
        return False


async def test_multiple_rounds():
    """æµ‹è¯•å¤šè½®åˆ†æåœºæ™¯"""

    print("\n" + "="*80)
    print("ğŸ§ª æµ‹è¯•ï¼šå¤šè½®åˆ†æåœºæ™¯")
    print("="*80)

    from src.agents.supervisor_agent import SupervisorAgent

    supervisor = SupervisorAgent()

    # ç¬¬ä¸€è½®åˆ†æç»“æœ
    round1_results = {
        "cost": "é€‰é¡¹Aæˆæœ¬è¾ƒä½ï¼Œé€‰é¡¹Bæˆæœ¬è¾ƒé«˜",
        "risk": "é€‰é¡¹Aé£é™©ä½ï¼Œé€‰é¡¹Bé£é™©é«˜",
        "value": "é€‰é¡¹Aæ›´ç¬¦åˆä»·å€¼è§‚"
    }

    # ç¬¬äºŒè½®åˆ†æç»“æœï¼ˆé«˜åº¦ç›¸ä¼¼ï¼‰
    round2_results = {
        "cost": "é€‰é¡¹Aæˆæœ¬è¾ƒä½ï¼Œé€‰é¡¹Bæˆæœ¬è¾ƒé«˜",
        "risk": "é€‰é¡¹Aé£é™©ä½ï¼Œé€‰é¡¹Bé£é™©é«˜",
        "value": "é€‰é¡¹Aæ›´ç¬¦åˆä»·å€¼è§‚"
    }

    print(f"\nğŸ“Š ç¬¬ä¸€è½®åˆ†æç»“æœï¼š")
    for key, value in round1_results.items():
        print(f"  {key}: {value}")

    # æµ‹è¯•ç¬¬ä¸€è½®æ˜¯å¦ç»§ç»­
    should_stop_1, reason_1 = supervisor.should_stop_analysis(
        current_round=1,
        previous_results=None,
        current_results=round1_results
    )

    print(f"\nğŸ” ç¬¬ä¸€è½®ç»ˆæ­¢åˆ¤æ–­ï¼š")
    print(f"  æ˜¯å¦åº”è¯¥åœæ­¢ï¼š{should_stop_1}")
    print(f"  åŸå› ï¼š{reason_1}")

    # æµ‹è¯•ç¬¬äºŒè½®æ˜¯å¦åœæ­¢ï¼ˆç»“æœæ”¶æ•›ï¼‰
    should_stop_2, reason_2 = supervisor.should_stop_analysis(
        current_round=2,
        previous_results=round1_results,
        current_results=round2_results
    )

    print(f"\nğŸ” ç¬¬äºŒè½®ç»ˆæ­¢åˆ¤æ–­ï¼š")
    print(f"  æ˜¯å¦åº”è¯¥åœæ­¢ï¼š{should_stop_2}")
    print(f"  åŸå› ï¼š{reason_2}")

    # éªŒè¯
    assert should_stop_2, "ç¬¬äºŒè½®ç»“æœæ”¶æ•›æ—¶åº”è¯¥åœæ­¢"
    print(f"\nâœ… å¤šè½®åˆ†ææµ‹è¯•é€šè¿‡ï¼šç¬¬äºŒè½®ç»“æœæ”¶æ•›æ—¶æˆåŠŸåœæ­¢")

    return True


async def main():
    """è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•"""

    print("\n" + "="*80)
    print("ğŸš€ DecideX ç»¼åˆå†³ç­– Agent é›†æˆæµ‹è¯•å¥—ä»¶")
    print("="*80)

    print("\nğŸ“‹ æµ‹è¯•ç›®æ ‡ï¼š")
    print("  1. éªŒè¯ç»¼åˆå†³ç­– Agent èƒ½å¦æ¥æ”¶å‰ä¸‰ä¸ª Agent çš„è¾“å‡º")
    print("  2. éªŒè¯ç»¼åˆå†³ç­– Agent èƒ½å¦æ­£ç¡®å¤„ç†è¿™äº›è¾“å…¥")
    print("  3. éªŒè¯ç»¼åˆå†³ç­– Agent èƒ½å¦ç”Ÿæˆç¬¦åˆè¦æ±‚çš„æœ€ç»ˆå†³ç­–")
    print("  4. éªŒè¯å¤šè½®åˆ†æåœºæ™¯ä¸‹çš„ç»ˆæ­¢åˆ¤æ–­")

    try:
        # æµ‹è¯• 1: ä¸å‰ä¸‰ä¸ª Agent çš„é›†æˆ
        test1_passed = await test_supervisor_with_real_agent_outputs()

        # æµ‹è¯• 2: å¤šè½®åˆ†æåœºæ™¯
        test2_passed = await test_multiple_rounds()

        # æ€»ç»“
        print("\n" + "="*80)
        print("ğŸ“Š æµ‹è¯•æ€»ç»“")
        print("="*80)
        print(f"  é›†æˆæµ‹è¯•ï¼š{'âœ… é€šè¿‡' if test1_passed else 'âŒ å¤±è´¥'}")
        print(f"  å¤šè½®æµ‹è¯•ï¼š{'âœ… é€šè¿‡' if test2_passed else 'âŒ å¤±è´¥'}")

        if test1_passed and test2_passed:
            print("\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç»¼åˆå†³ç­– Agent å·¥ä½œæ­£å¸¸ï¼")
            print("\nğŸ’¡ ç»“è®ºï¼š")
            print("  âœ… ç»¼åˆå†³ç­– Agent èƒ½å¤ŸæˆåŠŸæ¥æ”¶å‰ä¸‰ä¸ª Agent çš„è¾“å‡º")
            print("  âœ… ç»¼åˆå†³ç­– Agent èƒ½å¤Ÿæ­£ç¡®å¤„ç†ä¸‰ä¸ªç»´åº¦çš„åˆ†æç»“æœ")
            print("  âœ… ç»¼åˆå†³ç­– Agent èƒ½å¤Ÿç”Ÿæˆå”¯ä¸€ã€æ˜ç¡®ã€ä¸å¯å›é€€çš„æœ€ç»ˆå†³ç­–")
            print("  âœ… ç»ˆæ­¢åˆ¤æ–­æœºåˆ¶å·¥ä½œæ­£å¸¸")
        else:
            print("\nâš ï¸  éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯")

        print("="*80)

    except Exception as e:
        print(f"\nâŒ æµ‹è¯•å¥—ä»¶è¿è¡Œå¤±è´¥ï¼š{str(e)}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    asyncio.run(main())
