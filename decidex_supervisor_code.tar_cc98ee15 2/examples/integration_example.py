"""
ç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent çš„é›†æˆç¤ºä¾‹

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºå¦‚ä½•å°†ç»¼åˆå†³ç­– Agent ä¸ä½ å·²ç»å®ç°çš„
æˆæœ¬åˆ†æ Agentã€é£é™©è¯„ä¼° Agentã€ç”¨æˆ·ä»·å€¼ Agent è¿æ¥èµ·æ¥ã€‚
"""

import asyncio
import sys
import os

# æ·»åŠ é¡¹ç›®è·¯å¾„
project_root = os.path.join(os.path.dirname(__file__), '..')
sys.path.insert(0, project_root)
src_path = os.path.join(project_root, 'src')
if src_path not in sys.path:
    sys.path.insert(0, src_path)


async def integration_example():
    """
    é›†æˆç¤ºä¾‹ï¼šç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent åä½œ

    å‡è®¾ä½ å·²ç»å®ç°äº†å‰ä¸‰ä¸ª Agentï¼š
    1. æˆæœ¬åˆ†æ Agent
    2. é£é™©è¯„ä¼° Agent
    3. ç”¨æˆ·ä»·å€¼ Agent
    """

    print("\n" + "="*80)
    print("ğŸ”— ç»¼åˆå†³ç­– Agent ä¸å‰ä¸‰ä¸ª Agent é›†æˆç¤ºä¾‹")
    print("="*80)

    # ========================================
    # æ­¥éª¤ 1: å¯¼å…¥ç»¼åˆå†³ç­– Agent
    # ========================================
    from src.agents.supervisor_agent import SupervisorAgent

    supervisor = SupervisorAgent()

    # ========================================
    # æ­¥éª¤ 2: è°ƒç”¨ä½ çš„ä¸‰ä¸ª Agent è·å–åˆ†æç»“æœ
    # ========================================
    print("\nğŸ“‹ æ­¥éª¤ 1/4: è°ƒç”¨æˆæœ¬åˆ†æ Agent")
    print("-" * 80)

    # è¿™é‡Œè°ƒç”¨ä½ å·²ç»å®ç°çš„æˆæœ¬åˆ†æ Agent
    # cost_result = await your_cost_agent.analyze(user_query, options)

    # æ¨¡æ‹Ÿæˆæœ¬åˆ†æ Agent çš„è¾“å‡º
    cost_result = """
## ğŸ’° æˆæœ¬åˆ†æ

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- æ—¶é—´æˆæœ¬ï¼šéœ€è¦é€‚åº”æœŸ 1-3 ä¸ªæœˆ
- é‡‘é’±æˆæœ¬ï¼šåˆæœŸå¯èƒ½è–ªèµ„ç•¥ä½ï¼Œä½†æœ‰å¢é•¿ç©ºé—´
- èµ„æºæˆæœ¬ï¼šéœ€è¦é‡æ–°å»ºç«‹äººé™…å…³ç³»å’Œå·¥ä½œæµç¨‹
- æœºä¼šæˆæœ¬ï¼šå¤±å»å½“å‰å…¬å¸çš„ç¨³å®šæ€§å’Œç†Ÿæ‚‰çš„å·¥ä½œç¯å¢ƒ
- **ç»¼åˆæˆæœ¬è¯„åˆ†**ï¼š6/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- æ—¶é—´æˆæœ¬ï¼šæ— éœ€é€‚åº”æœŸï¼Œå¯ç«‹å³æŠ•å…¥å·¥ä½œ
- é‡‘é’±æˆæœ¬ï¼šå½“å‰è–ªèµ„ç¨³å®šï¼Œä½†å¢é•¿æœ‰é™
- èµ„æºæˆæœ¬ï¼šå·²æœ‰å®Œå–„çš„äººé™…å…³ç³»å’Œå·¥ä½œæµç¨‹
- æœºä¼šæˆæœ¬ï¼šå¤±å»æ–°æœºä¼šå’Œå‘å±•ç©ºé—´
- **ç»¼åˆæˆæœ¬è¯„åˆ†**ï¼š4/10

### ğŸ’¡ æˆæœ¬ç»´åº¦æ¨è
ä»æˆæœ¬è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šæ—¶é—´æˆæœ¬å’Œèµ„æºæˆæœ¬æ›´ä½ï¼Œé€‚åº”å‹åŠ›å°ï¼Œç¡®å®šæ€§æ›´å¼º
"""
    print(f"âœ… æˆæœ¬åˆ†æå®Œæˆ")
    print(f"   - åˆ†æäº† 2 ä¸ªé€‰é¡¹")
    print(f"   - æ¨èï¼šç•™åœ¨åŸå…¬å¸")

    print("\nğŸ“‹ æ­¥éª¤ 2/4: è°ƒç”¨é£é™©è¯„ä¼° Agent")
    print("-" * 80)

    # è¿™é‡Œè°ƒç”¨ä½ å·²ç»å®ç°çš„é£é™©è¯„ä¼° Agent
    # risk_result = await your_risk_agent.analyze(user_query, options)

    # æ¨¡æ‹Ÿé£é™©è¯„ä¼° Agent çš„è¾“å‡º
    risk_result = """
## âš ï¸ é£é™©è¯„ä¼°

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- ä¸ç¡®å®šæ€§å› ç´ ï¼šæ–°å…¬å¸æ–‡åŒ–ã€å›¢é˜Ÿæ°›å›´ã€å·¥ä½œå†…å®¹
- æœ€åæƒ…å†µï¼šä¸é€‚åº”æ–°ç¯å¢ƒï¼Œ3ä¸ªæœˆå†…ç¦»èŒ
- å¤±è´¥æ¦‚ç‡ï¼šä¸­ç­‰ï¼ˆ40%ï¼‰
- å¯é€†æ€§ï¼šéƒ¨åˆ†å¯é€†ï¼Œä½†ä¼šå½±å“ç®€å†å’ŒèŒä¸šå‘å±•
- **ç»¼åˆé£é™©è¯„åˆ†**ï¼š7/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- ä¸ç¡®å®šæ€§å› ç´ ï¼šå…¬å¸å‘å±•å‰æ™¯ã€ä¸ªäººæ™‹å‡ç©ºé—´
- æœ€åæƒ…å†µï¼šå…¬å¸ä¸šåŠ¡èç¼©ï¼Œè¢«è¿«ç¦»èŒ
- å¤±è´¥æ¦‚ç‡ï¼šä½ï¼ˆ20%ï¼‰
- å¯é€†æ€§ï¼šä¸å¯é€†ï¼Œé”™è¿‡äº†å½“å‰è·³æ§½çš„æœ€ä½³æ—¶æœº
- **ç»¼åˆé£é™©è¯„åˆ†**ï¼š5/10

### ğŸ’¡ é£é™©ç»´åº¦æ¨è
ä»é£é™©è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šé£é™©æœ€ä½ï¼ˆ5/10ï¼‰ï¼Œç¡®å®šæ€§æœ€å¼ºï¼Œå¤±è´¥æ¦‚ç‡æœ€å°
"""
    print(f"âœ… é£é™©è¯„ä¼°å®Œæˆ")
    print(f"   - è¯„ä¼°äº† 2 ä¸ªé€‰é¡¹çš„é£é™©")
    print(f"   - æ¨èï¼šç•™åœ¨åŸå…¬å¸")

    print("\nğŸ“‹ æ­¥éª¤ 3/4: è°ƒç”¨ç”¨æˆ·ä»·å€¼ Agent")
    print("-" * 80)

    # è¿™é‡Œè°ƒç”¨ä½ å·²ç»å®ç°çš„ç”¨æˆ·ä»·å€¼ Agent
    # value_result = await your_value_agent.analyze(user_query, options)

    # æ¨¡æ‹Ÿç”¨æˆ·ä»·å€¼ Agent çš„è¾“å‡º
    value_result = """
## ğŸ’ ä»·å€¼åŒ¹é…åˆ†æ

åŸºäºç”¨æˆ·çš„å†å²å¯¹è¯ï¼Œç”¨æˆ·é‡è§†ç¨³å®šæ€§å’Œå®‰å…¨æ„Ÿã€‚

### é€‰é¡¹1ï¼šè·³æ§½åˆ°æ–°å…¬å¸
- æˆå°±å¯¼å‘ï¼š9/10ï¼Œæœ‰æ›´å¤šæˆé•¿å’ŒæŒ‘æˆ˜æœºä¼š
- å®‰å…¨æ„Ÿï¼š4/10ï¼Œä¸ç¡®å®šæ€§è¾ƒé«˜
- è‡ªä¸»æ€§ï¼š7/10ï¼Œå¯èƒ½è·å¾—æ›´å¤šè‡ªä¸»æƒ
- å…³ç³»å¯¼å‘ï¼š5/10ï¼Œéœ€è¦é‡æ–°å»ºç«‹äººé™…å…³ç³»
- **ç»¼åˆä»·å€¼è¯„åˆ†**ï¼š6/10

### é€‰é¡¹2ï¼šç•™åœ¨åŸå…¬å¸
- æˆå°±å¯¼å‘ï¼š5/10ï¼Œå‘å±•ç©ºé—´æœ‰é™
- å®‰å…¨æ„Ÿï¼š9/10ï¼Œå·¥ä½œç¨³å®šï¼Œç¯å¢ƒç†Ÿæ‚‰
- è‡ªä¸»æ€§ï¼š6/10ï¼Œæœ‰ä¸€å®šè‡ªä¸»æƒä½†ç©ºé—´æœ‰é™
- å…³ç³»å¯¼å‘ï¼š8/10ï¼Œå·²æœ‰ç¨³å®šçš„äººé™…å…³ç³»
- **ç»¼åˆä»·å€¼è¯„åˆ†**ï¼š7/10

### ğŸ’¡ ä»·å€¼ç»´åº¦æ¨è
ä»ç”¨æˆ·ä»·å€¼è§‚è§’åº¦ï¼Œæˆ‘å»ºè®®ä¼˜å…ˆè€ƒè™‘ï¼šç•™åœ¨åŸå…¬å¸
**ç†ç”±**ï¼šæ›´ç¬¦åˆç”¨æˆ·é‡è§†çš„å®‰å…¨æ„Ÿå’Œç¨³å®šæ€§ä»·å€¼è§‚
"""
    print(f"âœ… ç”¨æˆ·ä»·å€¼åˆ†æå®Œæˆ")
    print(f"   - åˆ†æäº† 4 ä¸ªä»·å€¼ç»´åº¦")
    print(f"   - æ¨èï¼šç•™åœ¨åŸå…¬å¸")

    # ========================================
    # æ­¥éª¤ 3: å°†ä¸‰ä¸ª Agent çš„è¾“å‡ºä¼ é€’ç»™ç»¼åˆå†³ç­– Agent
    # ========================================
    print("\nğŸ“‹ æ­¥éª¤ 4/4: è°ƒç”¨ç»¼åˆå†³ç­– Agent")
    print("-" * 80)

    print(f"\nâ³ æ­£åœ¨æ±‡æ€»ä¸‰ä¸ªç»´åº¦çš„åˆ†æç»“æœ...")

    # è°ƒç”¨ç»¼åˆå†³ç­– Agent
    decision_result = await supervisor.make_decision(
        cost_analysis=cost_result,
        risk_analysis=risk_result,
        value_analysis=value_result,
        current_round=1
    )

    # ========================================
    # æ­¥éª¤ 4: è·å–æœ€ç»ˆå†³ç­–
    # ========================================
    print(f"\n" + "="*80)
    print("âœ… æœ€ç»ˆå†³ç­–")
    print("="*80)
    print(decision_result['final_decision'])

    print(f"\nğŸ“‹ å†³ç­–ä¿¡æ¯ï¼š")
    print(f"  - åº”è¯¥åœæ­¢åˆ†æï¼š{'æ˜¯' if decision_result['should_stop'] else 'å¦'}")
    print(f"  - åœæ­¢åŸå› ï¼š{decision_result['stop_reason']}")
    print(f"  - å½“å‰è½®æ¬¡ï¼š{decision_result['current_round']}")

    print(f"\nğŸ“Š æ•°æ®æµæ€»ç»“ï¼š")
    print(f"  æˆæœ¬åˆ†æ Agent â†’ æˆæœ¬åˆ†æç»“æœ â†’ ç»¼åˆå†³ç­– Agent")
    print(f"  é£é™©è¯„ä¼° Agent â†’ é£é™©è¯„ä¼°ç»“æœ â†’ ç»¼åˆå†³ç­– Agent")
    print(f"  ç”¨æˆ·ä»·å€¼ Agent â†’ ç”¨æˆ·ä»·å€¼åˆ†æç»“æœ â†’ ç»¼åˆå†³ç­– Agent")
    print(f"  ç»¼åˆå†³ç­– Agent â†’ æœ€ç»ˆå†³ç­–å»ºè®®")

    return decision_result


async def multi_round_integration():
    """
    å¤šè½®åˆ†æé›†æˆç¤ºä¾‹

    å±•ç¤ºå¦‚ä½•åœ¨å¤šè½®åˆ†æåœºæ™¯ä¸­ä½¿ç”¨ç»¼åˆå†³ç­– Agent
    """

    print("\n" + "="*80)
    print("ğŸ”„ å¤šè½®åˆ†æé›†æˆç¤ºä¾‹")
    print("="*80)

    from src.agents.supervisor_agent import SupervisorAgent

    supervisor = SupervisorAgent()

    current_round = 1
    max_rounds = 2

    while current_round <= max_rounds:
        print(f"\nğŸ“Š ç¬¬ {current_round} è½®åˆ†æ")
        print("-" * 80)

        # æ¯ä¸€è½®éƒ½è°ƒç”¨ä¸‰ä¸ª Agent
        cost_result = "æˆæœ¬åˆ†æç»“æœ..."
        risk_result = "é£é™©è¯„ä¼°ç»“æœ..."
        value_result = "ç”¨æˆ·ä»·å€¼åˆ†æç»“æœ..."

        print(f"âœ… æˆæœ¬åˆ†æå®Œæˆ")
        print(f"âœ… é£é™©è¯„ä¼°å®Œæˆ")
        print(f"âœ… ç”¨æˆ·ä»·å€¼åˆ†æå®Œæˆ")

        # è°ƒç”¨ç»¼åˆå†³ç­– Agent
        decision_result = await supervisor.make_decision(
            cost_analysis=cost_result,
            risk_analysis=risk_result,
            value_analysis=value_result,
            current_round=current_round
        )

        # åˆ¤æ–­æ˜¯å¦åº”è¯¥åœæ­¢
        if decision_result['should_stop']:
            print(f"\nâ¹ï¸  ç»ˆæ­¢åˆ†æï¼š{decision_result['stop_reason']}")
            print(f"\n{decision_result['final_decision']}")
            break

        current_round += 1

    print(f"\nğŸ“Š æ€»å…±è¿›è¡Œäº† {current_round} è½®åˆ†æ")


async def main():
    """è¿è¡Œæ‰€æœ‰é›†æˆç¤ºä¾‹"""

    print("\n" + "="*80)
    print("ğŸš€ ç»¼åˆå†³ç­– Agent é›†æˆç¤ºä¾‹")
    print("="*80)

    print("\nğŸ’¡ è¯´æ˜ï¼š")
    print("  ç»¼åˆå†³ç­– Agent éœ€è¦æ¥æ”¶å‰ä¸‰ä¸ª Agent çš„è¾“å‡ºæ‰èƒ½å·¥ä½œã€‚")
    print("  æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•å°†ç»¼åˆå†³ç­– Agent ä¸ä½ çš„ä¸‰ä¸ª Agent é›†æˆã€‚")

    # ç¤ºä¾‹ 1: å•è½®åˆ†æ
    await integration_example()

    # ç¤ºä¾‹ 2: å¤šè½®åˆ†æ
    await multi_round_integration()

    print("\n" + "="*80)
    print("âœ… é›†æˆç¤ºä¾‹è¿è¡Œå®Œæˆ")
    print("="*80)


if __name__ == "__main__":
    asyncio.run(main())
